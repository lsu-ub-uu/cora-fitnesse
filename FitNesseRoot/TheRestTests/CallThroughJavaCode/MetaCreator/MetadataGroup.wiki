---
Test
---
!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.fitnesse |

!1 Testing metacompleter and creator for metadataGroup
If text ids are not provided when creating a metadataGroup, the text ids are added and the texts are created in storage if they do not already exist.

Read texts to make sure they do not exist

!***> Read fitnesseBookGroupText and fitnesseBookGroupDefText

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseBookGroupText | coraText | | NOT_FOUND |
| fitnesseBookGroupDefText | coraText | | NOT_FOUND |

*!
When a metadataGroup is created, two presentationGroups are automatically created, one for input and one for output.

Read pGroups to make sure they do not exist

!***> Read fitnesseBookPGroup and fitnesseBookOutputPGroup

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseBookPGroup | presentationGroup | | NOT_FOUND |
| fitnesseBookOutputPGroup | presentationGroup | | NOT_FOUND |

*!
!2 
!2 Create a new metadataGroup
!***> Create a new metadataGroup (fitnesseBookGroup)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? |
| $adminAuthToken | metadataGroup | {"name":"metadata","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseBookGroup"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}]}]},{"name":"nameInData","value":"fitnesseBook"},{"name":"childReferences","children":[{"name":"childReference","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"recordInfoGroup"}]}],"repeatId":"0"}]}],"attributes":{"type":"group"}} | | CREATED |

*!
Read fitnesseBookGroup to see that links to texts have been added to the metadata

!***> Read fitnesseBookGroup

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseBookGroup | metadataGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"fitnesseBookGroup"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/system/testSystem","accept":"application/vnd.uub.record+json"}},"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"metadataGroup"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/recordType/metadataGroup","accept":"application/vnd.uub.record+json"}},"name":"type"},{"name":"createdBy","value":"131313"}],"name":"recordInfo"},{"name":"nameInData","value":"fitnesseBook"},{"children":[{"repeatId":"0","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"recordInfoGroup"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/metadata/recordInfoGroup","accept":"application/vnd.uub.record+json"}},"name":"ref"}],"name":"childReference"}],"name":"childReferences"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnesseBookGroupText"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/text/fitnesseBookGroupText","accept":"application/vnd.uub.record+json"}},"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnesseBookGroupDefText"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/text/fitnesseBookGroupDefText","accept":"application/vnd.uub.record+json"}},"name":"defTextId"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseBookGroup","accept":"application/vnd.uub.record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseBookGroup/incomingLinks","accept":"application/vnd.uub.recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/vnd.uub.record+json","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseBookGroup","accept":"application/vnd.uub.record+json"}}}} | OK |

*!
Read texts again to see that they have been created

!***> Read fitnesseBookGroupText and fitnesseBookGroupDefText

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseBookGroupText | coraText | | OK |
| fitnesseBookGroupDefText | coraText | | OK |

*!
Read presentationGroups again to see that they have been created

!***> Read fitnesseBookPGroup and fitnesseBookOutputPGroup

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseBookPGroup | presentationGroup | | OK |
| fitnesseBookOutputPGroup | presentationGroup | | OK |

*!
!1 Reset testdata
Remove data created for this test

!***> Delete created metadataGroup, presentationGroups and texts

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | presentationGroup | fitnesseBookPGroup | | OK |
| $adminAuthToken | presentationGroup | fitnesseBookOutputPGroup | | OK |
| $adminAuthToken | metadataGroup | fitnesseBookGroup | | OK |
| $adminAuthToken | coraText | fitnesseBookGroupText | | OK |
| $adminAuthToken | coraText | fitnesseBookGroupDefText | | OK |

*!
!2 Create a new metadataGroup with excludePGroupCreation option set to true
!***> Create a new metadataGroup (fitnesseWithNoPGroupsBookGroup)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? |
| $adminAuthToken | metadataGroup | {"name":"metadata","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseWithNoPGroupsBookGroup"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}]}]},{"name":"nameInData","value":"fitnesseBook"},{"name":"excludePGroupCreation","value":"true"},{"name":"childReferences","children":[{"name":"childReference","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"recordInfoGroup"}]}],"repeatId":"0"}]}],"attributes":{"type":"group"}} | | CREATED |

*!
Read fitnesseWithNoPGroupsBookGroup to see that links to texts have been added to the metadata

!***> Read fitnesseWithNoPGroupsBookGroup

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseWithNoPGroupsBookGroup | metadataGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"fitnesseWithNoPGroupsBookGroup"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/system/testSystem","accept":"application/vnd.uub.record+json"}},"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"metadataGroup"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/recordType/metadataGroup","accept":"application/vnd.uub.record+json"}},"name":"type"},{"name":"createdBy","value":"131313"}],"name":"recordInfo"},{"name":"nameInData","value":"fitnesseBook"},{"name":"excludePGroupCreation","value":"true"},{"children":[{"repeatId":"0","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"recordInfoGroup"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/metadata/recordInfoGroup","accept":"application/vnd.uub.record+json"}},"name":"ref"}],"name":"childReference"}],"name":"childReferences"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnesseWithNoPGroupsBookGroupText"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/text/fitnesseWithNoPGroupsBookGroupText","accept":"application/vnd.uub.record+json"}},"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnesseWithNoPGroupsBookGroupDefText"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/text/fitnesseWithNoPGroupsBookGroupDefText","accept":"application/vnd.uub.record+json"}},"name":"defTextId"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseWithNoPGroupsBookGroup","accept":"application/vnd.uub.record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/vnd.uub.record+json","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseWithNoPGroupsBookGroup","accept":"application/vnd.uub.record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"${systemUnderTestUrl}rest/record/metadataGroup/fitnesseWithNoPGroupsBookGroup"}}}} | OK |

*!
Read texts again to see that they have been created

!***> Read fitnesseWithNoPGroupsBookGroupText and fitnesseWithNoPGroupsBookGroupDefText

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseWithNoPGroupsBookGroupText | coraText | | OK |
| fitnesseWithNoPGroupsBookGroupDefText | coraText | | OK |

*!
Read presentationGroups to see that they have NOT been created

!***> Read fitnesseWithNoPGroupsBookPGroup and fitnesseWithNoPGroupsBookOutputPGroup

!| RecordEndpointFixture |
| id | type | testReadRecord? | getStatusType? |
| fitnesseWithNoPGroupsBookPGroup | presentationGroup | | NOT_FOUND |
| fitnesseWithNoPGroupsBookOutputPGroup | presentationGroup | | NOT_FOUND |

*!
!1 Reset testdata
Remove data created for this test

!***> Delete created metadataGroup, presentationGroups and texts

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | metadataGroup | fitnesseWithNoPGroupsBookGroup | | OK |
| $adminAuthToken | coraText | fitnesseWithNoPGroupsBookGroupText | | OK |
| $adminAuthToken | coraText | fitnesseWithNoPGroupsBookGroupDefText | | OK |

*!
