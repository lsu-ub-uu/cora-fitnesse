!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.fitnesse |

!1 !-SystemOneUserTest-!
A test that first reads all predefined metadata needed to be able to create users and then tests adding and updating a user.

!2 Read predefined metadata to make sure it is correct
!***> Read metadataGroups for systemOneUser(systemOneUserNewGroup, systemOneUserGroup)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | metadataGroup | systemOneUserNewGroup | =~/"name":"linkedRecordId","value":"userIdTextVar".*"name":"linkedRecordId","value":"userFirstnameTextVar".*"name":"linkedRecordId","value":"userLastnameTextVar".*"name":"linkedRecordId","value":"systemOneUserRoleRelationGroup".*"name":"linkedRecordId","value":"activeStatusCollectionVar".*"name":"linkedRecordId","value":"userAppTokenGroup"/ | OK |
| $adminAuthToken | metadataGroup | systemOneUserGroup | =~/"name":"linkedRecordId","value":"userIdTextVar".*"name":"linkedRecordId","value":"userFirstnameTextVar".*"name":"linkedRecordId","value":"userLastnameTextVar".*"name":"linkedRecordId","value":"systemOneUserRoleRelationGroup".*"name":"linkedRecordId","value":"activeStatusCollectionVar".*"name":"linkedRecordId","value":"userAppTokenGroup"/ | OK |

*!
!***> Read systemOneUserGroup child systemOneUserRoleRelationGroup, and the descending children of that group

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | metadataGroup | systemOneUserRoleRelationGroup | =~/"name":"linkedRecordId","value":"userRoleLink".*"name":"linkedRecordId","value":"systemOneUserRoleRulePartGroup".*"name":"linkedRecordId","value":"userRoleRelationGroup"/ | |
| $adminAuthToken | metadataRecordLink | userRoleLink | =~/"name":"linkedRecordId","value":"permissionRole"/ | OK |
| $adminAuthToken | metadataGroup | systemOneUserRoleRulePartGroup | =~/"name":"linkedRecordId","value":"permissionRulePartOrganisationGroup".*"name":"linkedRecordId","value":"userRoleRulePartGroup"/ | |
| $adminAuthToken | metadataGroup | permissionRulePartOrganisationGroup | =~/"name":"linkedRecordId","value":"permissionRulePartValueTextVar".*"name":"linkedRecordId","value":"permissionRulePartTypeOrganisationCollectionVar".*"name":"attributeReferences"/ | OK |

*!
!***> Read recordType (systemOneUser)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | systemOneUser | | OK |

*!
!2 Test with new systemOneUser
!***> Create data of recordType systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | json | testCreateRecordCreatedType? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | {"name":"user","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUser"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]}]},{"name":"userId","value":"fitnesseUser@system.cora.uu.se"},{"name":"userFirstname","value":"Some"},{"name":"userLastname","value":"User"},{"name":"userRole","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"user"}]},{"name":"userRoleRulePart","children":[{"name":"permissionRulePart","children":[{"name":"permissionRulePartValue","value":"system.","repeatId":"0"}],"attributes":{"type":"organisation"}}]}],"repeatId":"0"},{"name":"activeStatus","value":"active"}]} | systemOneUser | CREATED |

*!
!***> Read systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | | OK |

*!
!***> Update data of recordType systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | {"name":"user","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUser"},{"name":"type","children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"systemOneUser"}]},{"name":"createdBy","children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}]},{"name":"tsCreated","value":"2017-10-01 00:00:00"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]}]},{"name":"userId","value":"fitnesseUser@system.cora.uu.se"},{"name":"userFirstname","value":"Some"},{"name":"userLastname","value":"User"},{"name":"userRole","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"user"}]},{"name":"userRoleRulePart","children":[{"name":"permissionRulePart","children":[{"name":"permissionRulePartValue","value":"system.","repeatId":"0"}],"attributes":{"type":"organisation"}}]}],"repeatId":"0"},{"name":"activeStatus","value":"active"}]} | | OK |

*!
!***> List data(systemOneUser)

!| RecordEndpointFixture |
| authToken | type | testReadRecordList? | getStatusType? |
| $adminAuthToken | systemOneUser | | OK |

*!
!2 Clean up created data
!***> Clean up created data

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | | OK |

*!
