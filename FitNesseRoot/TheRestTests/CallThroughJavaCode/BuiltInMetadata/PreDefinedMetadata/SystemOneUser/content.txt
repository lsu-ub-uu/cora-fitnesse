!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.fitnesseintegration |

!1 !-SystemOneUserTest-!
A test that first reads all predefined metadata needed to be able to create users and then tests adding and updating a user.

!2 Read predefined metadata to make sure it is correct
!***> Load systemOneUserNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | systemOneUserNewGroup | |

*!
!***> Check children in systemOneUserNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadataTextVariable | userIdTextVar | 1 | 1 |
| metadataTextVariable | userFirstnameTextVar | 1 | 1 |
| metadataTextVariable | userLastnameTextVar | 1 | 1 |
| metadataGroup | systemOneUserRoleRelationGroup | 1 | 1 |
| metadataCollectionVariable | activeStatusCollectionVar | 1 | 1 |

*!
!***> Load systemOneUserGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | systemOneUserGroup | |

*!
!***> Check children in systemOneUserGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadataTextVariable | userIdTextVar | 1 | 1 |
| metadataTextVariable | userFirstnameTextVar | 1 | 1 |
| metadataTextVariable | userLastnameTextVar | 1 | 1 |
| metadataGroup | systemOneUserRoleRelationGroup | not found | not found |
| metadataCollectionVariable | activeStatusCollectionVar | 1 | 1 |

*!
!***> Load systemOneUserRoleRelationGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | systemOneUserRoleRelationGroup | |

*!
!***> Check children in systemOneUserRoleRelationGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadataRecordLink | userRoleLink | 1 | 1 |
| metadataGroup | systemOneUserRoleRulePartGroup | not found | not found |

*!
!***> Read recordType (systemOneUser)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | systemOneUser | | OK |

*!
!2 Test with new systemOneUser
!***> Create data of recordType systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | json | testCreateRecordCreatedType? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | {"name":"user","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUser"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]}]},{"name":"userId","value":"fitnesseUser@system.cora.uu.se"},{"name":"userFirstname","value":"Some"},{"name":"userLastname","value":"User"},{"name":"userRole","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"user"}]},{"name":"userRoleRulePart","children":[{"name":"permissionRulePart","children":[{"name":"permissionRulePartValue","value":"system.","repeatId":"0"}],"attributes":{"type":"organisation"}}]}],"repeatId":"0"},{"name":"activeStatus","value":"active"}]} | systemOneUser | CREATED |

*!
!***> Read systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | | OK |

*!
!***> Update data of recordType systemOneUser

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | {"name":"user","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUser"},{"name":"type","children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"systemOneUser"}]},{"name":"createdBy","children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}]},{"name":"tsCreated","value":"2017-10-01 00:00:00.0"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]}]},{"name":"userId","value":"fitnesseUser@system.cora.uu.se"},{"name":"userFirstname","value":"Some"},{"name":"userLastname","value":"User"},{"name":"userRole","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"user"}]},{"name":"userRoleRulePart","children":[{"name":"permissionRulePart","children":[{"name":"permissionRulePartValue","value":"system.","repeatId":"0"}],"attributes":{"type":"organisation"}}]}],"repeatId":"0"},{"name":"activeStatus","value":"active"}]} | | OK |

*!
!***> List data(systemOneUser)

!| RecordEndpointFixture |
| authToken | type | testReadRecordList? | getStatusType? |
| $adminAuthToken | systemOneUser | | OK |

*!
!2 Clean up created data
!***> Clean up created data

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | systemOneUser | fitnesseUser | | OK |

*!
