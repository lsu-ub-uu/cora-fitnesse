---
Test
---
!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.fitnesseintegration |

!| script | SystemUrl |
| setUrl | ${systemUnderTestUrl} |
| setAppTokenVerifierUrl | ${appTokenVerifierUrl} |

!| script | DependencyProvider |
| setHttpHandlerFactoryClassName | se.uu.ub.cora.httphandler.HttpHandlerFactoryImp |

!2 Login  - call is made through java code
!***> Login for admin

!| AppTokenEndpointFixture |
| userId | appToken | getAuthTokenForAppToken? | getAuthToken? | getStatusType? |
| 131313 | | | $adminAuthToken= | CREATED |

*!
!| script | AuthTokenHolder |
| setAdminAuthToken | $adminAuthToken |

!***> Configure !-RestFixture-!

| Table:smartrics.rest.fitnesse.fixture.RestFixtureConfig | |
| restfixture.default.headers | Content-Type: application/vnd.uub.record+json!-
-!authToken:$adminAuthToken !-
-! |
| restfixture.content.handlers.map | application/vnd.uub.record+json=JSON!-
-!default=JSON |

*!
!***> Run a batch index job

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| POST | /rest/record/index/metadataTextVariable | 201 | !- Access-Control-Allow-Origin : \*
Content-Type : application/vnd.uub.record\+json
Content-Length : [\d]+  -! | jsonbody.record.data.name=="indexBatchJob" |

*!
!***> Run a batch index job with filter

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setBody | {"name":"indexSettings","children":[{"name":"filter","children":[{"name":"fromNo","value":"0"},{"name":"toNo","value":"10"}]}]} |
| POST | /rest/record/index/metadataTextVariable | 201 | !-Access-Control-Allow-Origin : \*
Content-Type : application/vnd.uub.record\+json
Content-Length : [\d]+ -! | jsonbody.record.data.children[4].value=="114" |

*!
