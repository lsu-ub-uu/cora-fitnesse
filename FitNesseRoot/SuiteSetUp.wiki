---
Suite
---
!***> Set up system and log in
| import |
| se.uu.ub.cora.fitnesseintegration |
| se.uu.ub.cora.fitnesseintegration.apptoken.script |
| se.uu.ub.cora.fitnesseintegration.authtoken.fixture |
| se.uu.ub.cora.fitnesseintegration.file |
| se.uu.ub.cora.fitnesseintegration.fixture |
| se.uu.ub.cora.fitnesseintegration.compare |
| se.uu.ub.cora.fitnesseintegration.script |
| se.uu.ub.cora.fitnesseintegration.waiter.fixture |
| se.uu.ub.cora.fitnesseintegration.server.compare.fixtures |
| se.uu.ub.cora.fitnesseintegration.binary |
| se.uu.ub.cora.fitnesseintegration.definitionwriter |
| se.uu.ub.cora.fitnesseintegration.authentication |

!| script | LoginToken |
| setFitnesseAdminLoginId | ${fitnesseAdminLoginId} |
| setFitnesseAdminAppToken | ${fitnesseAdminAppToken} |
| setFitnesseUserLoginId | ${fitnesseUserLoginId} |
| setFitnesseUserAppToken | ${fitnesseUserAppToken} |

!| script | SystemUrl |
| setUrl | ${systemUnderTestUrl} |
| setAppTokenVerifierUrl | ${appTokenVerifierUrl} |
| setIdpLoginUrl | ${idpLoginUrl} |
| setGatekeeperServerUrl | ${gatekeeperServerUrl} |

!| script | DependencyProvider |
| setHttpHandlerFactoryClassName | se.uu.ub.cora.httphandler.HttpHandlerFactoryImp |
| setChildComparerUsingClassName | se.uu.ub.cora.fitnesseintegration.ChildComparerImp |

!define TEST_SYSTEM {slim}

!***> Login for fitnesse admin, user and guest
!| AuthenticationFixture |
|  EPPN                           | idpLogin? | getStatusType? |getAuthToken?     | getRenewUrl?    |
| fitnesseAdmin@system.cora.uu.se |           | OK             | $adminAuthToken= | $adminRenewUrl= |
| fitnesseUser@system.cora.uu.se  |           | OK             | $userAuthToken=  | $userRenewUrl=  |
| userNotInDb@user.uu.se          |           | OK             | $guestAuthToken= | $guestRenewUrl= |

!| script | AuthTokenHolder |
| setAdminAuthToken | $adminAuthToken |
| setUserAuthToken  | $userAuthToken  |
*!
*!

!***> Read apptokens for fitnesse users
!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | user | 121212 | $read121212= | OK |
| $adminAuthToken | user | 131313 | $read131313= | OK |

!| script | ExtractSubstringUsingRegex |
| $fitnesseUserApptokenSecretId= | get substring using text | $read121212 | and regex | \{"name":"linkedRecordType","value":"systemSecret"\},\{"name":"linkedRecordId","value":"(systemSecret:\d*)"\} | and group | 1 |
| $fitnesseAdminApptokenSecretId= | get substring using text | $read131313 | and regex | \{"name":"linkedRecordType","value":"systemSecret"\},\{"name":"linkedRecordId","value":"(systemSecret:\d*)"\} | and group | 1 |
*!
