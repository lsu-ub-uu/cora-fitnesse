---
Test
---
!1 Trash bin 

The '''Trash bin''' function is a built-in feature in Cora that provides a mechanism for '''soft deletion''' of records.  
When a record is moved to the Trash bin, it is excluded from normal system operations, while '''privileged users''' retain the ability to view and restore it when required.

!2 What the function does
 * Enables individual records of a record type to be marked as '''trashed'''.
 * A trashed record has '''inTrashBin = true''' and is treated as deleted, but can be restored by setting the value to '''false'''.
 * Access to trashed recordsâ€”viewing, restoration, or permanent removalâ€”is typically restricted to privileged users.
 * If the record type also uses the '''Visibility''' function, visibility is automatically updated to '''unpublished''' when the record is trashed.
 * A '''trashed''' record maintains its links to other records, but:
  * The '''unique''' function excludes trashed records to ensure consistent uniqueness validation.
  * When deleting a target record, incoming links from trashed records are ignored.

!2 Why use the '''Trash bin''' function
The function supports two essential objectives:

 * '''Record retention''' â€“ All records remain preserved for audit, recovery, or administrative review until explicitly purged.
 * '''Safe deletion''' â€“ Unintended deletions can be reversed without permanent data loss.

'''Important:''' When restoring a trashed record, some links may be missing if the referenced records do not also support the '''Trash bin''' function.

!2 How to enable '''Trash bin''' on a record type
 * Enable the function in the '''record type''' configuration by setting '''useTrashBin = true'''.
 * Confirm that the field '''trashBinCollectionVar''' is present '''exactly once (1â€“1)''' within the '''recordInfo''' definition for the record type. The field is predefined and can be reused without modification.
 * Provide the necessary permissions to users via the permission term '''trashBinPermissionTerm'''.

After activation, the system automatically handles trashing, restoration, and any associated updates to visibility and linked-record behavior.

!2 Permission Terms
Most of the functionality uses permission term in mode '''state'''. Please see [[permission terms][.CoraTests.AccessControl.Authorization.PermissionTerm]] page for more information. 

!2 Use cases
 *'''Case 1: Deny creation when requirements are not met''' â€“ Creation is denied if the definition includes isInTrashBin but the recordType is configured not to use the trash bin.
 *'''Case 2: Default â€œnot in trashâ€ when creating a record''' â€“ When creating a record without an isInTrashBin value, the value defaults to false.
 *'''Case 3: Allow record creation''' â€“ Creation is permitted with any value in '''inTrashBin'''.
 *'''Case 4: Deny moving a record to trash''' â€“ A record cannot be moved to the trash bin if it has incoming links.
 *'''Case 5: Allow moving a record to trash''' â€“ A record may be moved to the trash bin when permitted.
  * '''Case 5.1:''' Users with the grant '''system.*''' are allowed to move a record to the trash bin.
  * '''Case 5.2:''' Users with the grant '''system.false''' are allowed to move a record to the trash bin.
 *'''Case 6: The record is no longer available for normal system operations''' â€“ Standard users cannot access the record once it is in the trash bin.
  * '''Case 6.1:''' The record is inaccessible to users with the grant '''system.false'''.
  * '''Case 6.2:''' Only users with the grant '''system.*''' may view or manage the record.
  * '''Case 6.3:''' Incoming links pointing to the record are ignored when the target record is deleted.
 *'''Case 7: Allow restoring a record (no longer in trash)''' â€“ Only explicitly authorized users may restore a record from the trash bin.

!2 ðŸ”€ Combination tests
!3 Unique:
 *'''Case 8: Records in the trash bin are ignored by the unique function''' â€“ When a record is in the trash bin, the unique function ignores it.

!3 Visibility:
 *'''Case 9: Record unpublished when record moved to trash bin''' â€“ When a '''published''' record of a record type that uses '''visibility''' is moved to trash the visibility of the record must be '''unpublished'''.

!***> Prepare tests
!include -seamless TrashBin.TrashBinSetup
*!

!***> Tests
!include -seamless TrashBin.TrashBinTests
*!

!***> Clean up created data
!include -seamless TrashBin.TrashBinCleanUp
*!
