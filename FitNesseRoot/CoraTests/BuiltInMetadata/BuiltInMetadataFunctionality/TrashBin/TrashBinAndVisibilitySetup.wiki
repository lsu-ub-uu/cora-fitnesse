---
Static
---
!***> Define variables
!define fitnesseRecordInfoNewGroupUsesTrashBinAndVisibility {!-{"children":[{"children":[{"name":"ignoreOverwriteProtection","value":"true"},{"name":"id","value":"fitnesseRecordInfoNewGroup"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"metadataGroup"}],"name":"validationType"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"metadata"}],"name":"type"}],"name":"recordInfo"},{"name":"nameInData","value":"recordInfo"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"recordInfoText"}],"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"recordInfoDefText"}],"name":"defTextId"},{"children":[{"repeatId":"2","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"dataDividerLink"}],"name":"ref"},{"children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"systemPermissionTerm"}],"name":"childRefCollectTerm","attributes":{"type":"permission"}}],"name":"childReference"},{"repeatId":"111","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"validationTypeLink"}],"name":"ref"}],"name":"childReference"},{"repeatId":"222","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"trashBinCollectionVar"}],"name":"ref"}],"name":"childReference"},{"name":"childReference","repeatId":"112","children":[{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"visibilityCollectionVar"}]},{"name":"childRefCollectTerm","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"visibilityPermissionTerm"}],"attributes":{"type":"permission"}}]},{"name":"childReference","repeatId":"113","children":[{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"tsVisibilityTextVar"}]},{"name":"recordPartConstraint","value":"write"}]}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}}-!}

!define fitnesseRecordInfoGroupUsesTrashBinAndVisibility {!-{"children":[{"children":[{"name":"ignoreOverwriteProtection","value":"true"},{"name":"id","value":"fitnesseRecordInfoGroup"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"metadataGroup"}],"name":"validationType"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"metadata"}],"name":"type"}],"name":"recordInfo"},{"name":"nameInData","value":"recordInfo"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"recordInfoText"}],"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"recordInfoDefText"}],"name":"defTextId"},{"children":[{"repeatId":"1","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"idTextVar"}],"name":"ref"},{"repeatId":"0","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"recordIdCollectIndexTerm"}],"name":"childRefCollectTerm","attributes":{"type":"index"}}],"name":"childReference"},{"repeatId":"5","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"recordTypeLink"}],"name":"ref"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"createdByLink"}],"name":"ref"}],"name":"childReference"},{"repeatId":"4","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"dataDividerLink"}],"name":"ref"},{"children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"systemPermissionTerm"}],"name":"childRefCollectTerm","attributes":{"type":"permission"}}],"name":"childReference"},{"repeatId":"6","children":[{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"X"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"permissionUnitLink"}],"name":"ref"}],"name":"childReference"},{"repeatId":"8","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"tsCreatedTextVar"}],"name":"ref"}],"name":"childReference"},{"repeatId":"10","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"X"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"updatedGroup"}],"name":"ref"}],"name":"childReference"},{"repeatId":"111","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"validationTypeLink"}],"name":"ref"}],"name":"childReference"},{"repeatId":"222","children":[{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"},{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"trashBinCollectionVar"}],"name":"ref"},{"name":"childRefCollectTerm","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"-!${fitnessePermissionTermName}!-"}],"attributes":{"type":"permission"}}],"name":"childReference"},{"name":"childReference","repeatId":"112","children":[{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"visibilityCollectionVar"}]},{"name":"childRefCollectTerm","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"visibilityPermissionTerm"}],"attributes":{"type":"permission"}}]},{"name":"childReference","repeatId":"113","children":[{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"},{"name":"ref","children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"tsVisibilityTextVar"}]},{"name":"recordPartConstraint","value":"write"}]}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}}-!}

!define fitnessePermissionTermRuleAndVisibility {!-{"children":[{"children":[{"name":"ignoreOverwriteProtection","value":"true"},{"name":"id","value":"fitnessePermissionTermRule"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"permissionRule"}],"name":"validationType"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"permissionRule"}],"name":"type"}],"name":"recordInfo"},{"children":[{"repeatId":"0","name":"permissionRulePartValue","value":"system.*"}],"name":"permissionRulePart","attributes":{"type":"action"}},{"children":[{"repeatId":"0","name":"permissionRulePartValue","value":"system.fitnesseRecordType"}],"name":"permissionRulePart","attributes":{"type":"recordType"}},{"name":"permissionTermRulePart","repeatId":"10","children":[{"name":"rule","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"visibilityPermissionTerm"}]},{"name":"value","repeatId":"0","value":"system.*"}]},{"name":"writePermissions","children":[{"name":"writePermission","repeatId":"3","value":"fitnesseRecordTypeWithVisibility.fitnesseTextVar"}]},{"name":"activeStatus","value":"active"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnessePermissionTermRuleText"}],"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnessePermissionTermRuleDefText"}],"name":"defTextId"}],"name":"permissionRule"}-!}

!define fitnessePermissionTermCreateRecordWithTrashBinAndVisibility {!-{"name":"fitnesseExample","children":[{"name":"recordInfo","children":[{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"fitnesseValidationType"}]},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]},{"name":"inTrashBin","value":"-!${fitnesseTrashBinValue}!-"},{"name":"visibility","value":"published"}]},{"name":"fitnesseTextVar","value":"someValue"}]}-!}

!define fitnessePermissionTermUpdateRecordWithTrashBinAndVisibility {!-{"children":[{"children":[{"name":"ignoreOverwriteProtection","value":"true"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"fitnesseValidationType"}],"name":"validationType"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"name":"id","value":"-!$createdRecordId!-"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"fitnesseRecordType"}],"name":"type"},{"name":"inTrashBin","value":"-!${fitnesseTrashBinValue}!-"},{"name":"visibility","value":"published"}],"name":"recordInfo"},{"repeatId":"0","name":"fitnesseTextVar","value":"someValue"}],"name":"fitnesseExample"}-!}

*!
!| UpdateRecordType |
| id                 | idSource | public | usePermissionUnit | useVisibility | useTrashBin | storeInArchive | update? |
| fitnesseRecordType | sequence | false  | false             | true          | true        | false          | OK      |

!define currentAuthToken {$adminAuthToken}
!***> Update recordInfo for new and update to use trash bin and visibility
!define recordType {metadata}
!define recordId {fitnesseRecordInfoNewGroup}
!define updateData {${fitnesseRecordInfoNewGroupUsesTrashBinAndVisibility}}
!define expectedUpdateResult {OK}
!define expectedAnswer {}
!include -seamless .HelperPages.updateRecord

!define recordType {metadata}
!define recordId {fitnesseRecordInfoGroup}
!define fitnessePermissionTermName {trashBinPermissionTerm}
!define updateData {${fitnesseRecordInfoGroupUsesTrashBinAndVisibility}}
!define expectedUpdateResult {OK}
!include -seamless .HelperPages.updateRecord
*!

!***> Update rule using visibility
!define recordType {permissionRule}
!define recordId {fitnessePermissionTermRule}
!define updateData {${fitnessePermissionTermRuleAndVisibility}}
!define expectedUpdateResult {OK}
!include -seamless .HelperPages.updateRecord
*!

!***> Grant user with trashBinPermissionTerm = system.*
!define fitnessePermissionTermName {trashBinPermissionTerm}
!define fitnessePermissionTermValue {system.*}
!define addFitnesseRole {${addFitnessePermissionTerm}}
!define updateData {${FITNESSE_USER_FOR_TEST_DATA}}
!define expectedUpdateResult {OK}
!include -seamless .HelperPages.updateFitnesseUser
*!
