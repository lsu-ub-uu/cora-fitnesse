---
Static
---

!2 Create a user

 * '''Case 1''': It must be possible to create a new user with a new unique userId
 * '''Case 2''': It must not be possible to create a new user with an already existing userId due to userId is expected to be field only allowing unique values


!***> Case 1 It must be possible to create a new user with a new unique userId

!define expectedCreateResult {CREATED}
!define aUniqueUserId {someUniqueUserId@system.cora.uu.se}
!define createUserPayload {!-{"name":"user","children":[{"name":"recordInfo","children":[{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"systemOneUser"}]}]},{"name":"userId","value":"-!${aUniqueUserId}!-"},{"name":"userFirstname","value":"someFirstName"},{"name":"userLastname","value":"someLastName"},{"name":"userRole","repeatId":"0","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"fitnesseTextAdmin"}]},{"name":"permissionTermRulePart","repeatId":"0","children":[{"name":"rule","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"systemPermissionTerm"}]},{"name":"value","repeatId":"0","value":"system.*"}]}]},{"name":"activeStatus","value":"active"},{"name":"usePassword","value":"false"}],"attributes":{"type":"systemOneUser"}}-!}

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? | getCreatedId? |
| $adminAuthToken | user | ${createUserPayload} | | ${expectedCreateResult} | $aNewUserId= |
*!

!***> Case 2 It must not be possible to create a new user with an already existing userId due to userId is expected to be field only allowing unique values

!define expectedCreateResult {BAD_REQUEST}
!define createAnotherUserPayload {!-{"name":"user","children":[{"name":"recordInfo","children":[{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"systemOneUser"}]}]},{"name":"userId","value":"-!${aUniqueUserId}!-"},{"name":"userFirstname","value":"anotherFirstName"},{"name":"userLastname","value":"anotherLastName"},{"name":"userRole","repeatId":"0","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"fitnesseTextAdmin"}]},{"name":"permissionTermRulePart","repeatId":"0","children":[{"name":"rule","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"systemPermissionTerm"}]},{"name":"value","repeatId":"0","value":"system.*"}]}]},{"name":"activeStatus","value":"active"},{"name":"usePassword","value":"false"}],"attributes":{"type":"systemOneUser"}}-!}
 
!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? | getCreatedId? |
| $adminAuthToken | user | ${createAnotherUserPayload} | | ${expectedCreateResult} | $aNewUserId2= |
*!

!***> Clean up data from test
!| Table:smartrics.rest.fitnesse.fixture.RestFixture|${systemUnderTestUrl}rest/    |
| setHeader | Accept:application/vnd.uub.record+json!-
-!Content-Type:application/vnd.uub.record+json!-
-!authToken:$adminAuthToken |
| DELETE | /record/user/$aNewUserId | | | |
| DELETE | /record/user/$aNewUserId2 | | | |
*!

