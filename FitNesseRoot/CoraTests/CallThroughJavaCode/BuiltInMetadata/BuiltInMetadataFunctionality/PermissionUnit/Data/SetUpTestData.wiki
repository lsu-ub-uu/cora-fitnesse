!***> Setup test data
!***> Create two permissionUnit and add to fitnesseUser (fitnessePermissionUnit & fitnessePermissionUnit2)
!define currentAuthToken {$adminAuthToken}
!define recordType {text}
!define createData {!-{"children":[{"children":[{"name":"id","value":"fitnessePermissionUnitText"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"coraText"}],"name":"validationType"}],"name":"recordInfo"},{"children":[{"name":"text","value":"rÃ¤ttighetsEnhetsText"}],"name":"textPart","attributes":{"type":"default","lang":"sv"}},{"children":[{"name":"text","value":"permissionUnitText"}],"name":"textPart","attributes":{"type":"alternative","lang":"en"}}],"name":"text"}-!}
!define expectedCreateResult {CREATED}
!define expectedAnswer {}
!include -seamless .HelperPages.createRecord

!define recordType {permissionUnit}
!define createData {!-{"name":"permissionUnit","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUserPermissionUnit"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"permissionUnit"}]}]},{"name":"name","children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnessePermissionUnitText"}]},{"name":"url","value":"someUrl"},{"name":"note","value":"someNote"}]}-!}
!include -seamless .HelperPages.createRecord

!define createData {!-{"name":"permissionUnit","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesseUserPermissionUnit2"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"permissionUnit"}]}]},{"name":"name","children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"fitnessePermissionUnitText"}]},{"name":"url","value":"someUrl2"},{"name":"note","value":"someNote2"}]}-!}
!include -seamless .HelperPages.createRecord

!define addfitnesseBinaryReadOnAllVisibilitiesRole {!-,{"name":"userRole","repeatId":"7175775086411622","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"fitnesseBinaryReadOnAllVisibilitiesRole"}]}]}-!}
!define addRecordInfofitnessePermissionUnit {!-,{"name":"permissionUnit","children":[{"name":"linkedRecordType","value":"permissionUnit"},{"name":"linkedRecordId","value":"fitnesseUserPermissionUnit"}]},-!}
!define addfitnessePermissionUnit {!-,{"name":"permissionUnit","repeatId":"123123","children":[{"name":"linkedRecordType","value":"permissionUnit"},{"name":"linkedRecordId","value":"fitnesseUserPermissionUnit"}]},{"name":"permissionUnit","repeatId":"456456","children":[{"name":"linkedRecordType","value":"permissionUnit"},{"name":"linkedRecordId","value":"fitnesseUserPermissionUnit2"}]},-!}

!define fitnesseUserWithPermissionUnits {!-{"attributes":{"type":"systemOneUser"},"name":"user","children":[{"name":"recordInfo","children":[{"name":"ignoreOverwriteProtection","value":"true"}-!${addRecordInfofitnessePermissionUnit}!-{"name":"id","value":"121212"},{"name":"type","children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"user"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"systemOneUser"}]},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]},{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}],"name":"createdBy"},{"name":"tsCreated","value":"2024-09-25T07:11:16.388968Z"},{"repeatId":"0","children":[{"name":"tsUpdated","value":"2024-09-25T07:11:16.388968Z"},{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}],"name":"updatedBy"}],"name":"updated"}]},{"name":"loginId","value":"fitnesseUser@system.cora.uu.se"},{"name":"userFirstname","value":"Fitnesse"},{"name":"userLastname","value":"User"},{"name":"userRole","repeatId":"7175775086411621","children":[{"name":"userRole","children":[{"name":"linkedRecordType","value":"permissionRole"},{"name":"linkedRecordId","value":"fitnesseTextAdmin"}]},{"name":"permissionTermRulePart","repeatId":"0","children":[{"name":"rule","children":[{"name":"linkedRecordType","value":"collectTerm"},{"name":"linkedRecordId","value":"systemPermissionTerm"}]},{"name":"value","repeatId":"0","value":"system.*"}]}]},{"name":"activeStatus","value":"active"},{"name":"usePassword","value":"true"},{"name":"plainTextPassword","value":"password"}-!${addfitnessePermissionUnit}!-{"name":"appTokens","children":[{"name":"appToken","children":[{"name":"appTokenNote","value":"Tokenfordevelopment"},{"name":"appTokenLink","children":[{"name":"linkedRecordType","value":"systemSecret"},{"name":"linkedRecordId","value":"systemSecret:3452520491234582"}]}],"repeatId":"0"}]}-!${addfitnesseBinaryReadOnAllVisibilitiesRole}!-]}-!}

!define recordType {user}
!define recordId {121212}
!define updateData {${fitnesseUserWithPermissionUnits}}
!define expectedUpdateResult {OK}

!include -seamless .HelperPages.updateRecord
*!

!***> Creation of a recordType with permission units
!define recordType {recordType}
!define addRecordInfofitnessePermissionUnit {!-,{"name":"permissionUnit","children":[{"name":"linkedRecordType","value":"permissionUnit"},{"name":"linkedRecordId","value":"fitnesseUserPermissionUnit"}]},-!}
!define createData {!--!}

!| ChildComparerFixture |
| authToken | type | json | testCreateAndStoreRecord? | getStatusType? | getCreatedId? |
| $adminAuthToken | ${recordType} | ${createData} |  | CREATED | $recordWithFitnessePermissionUnit= |
*!
*!
