!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.fitnesseintegration |

!1 !-BinaryTest-!
A test that first reads all predefined metadata needed to be able to add binary data to the system, and then tests adding and updating images.

!2 Read metadata defined in code to make sure it is correct
!***> Read textVariables (streamIdTextVar, filenameTextVar, filesizeTextVar, mimeTypeTextVar)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | metadata | streamIdTextVar | | OK |
| $adminAuthToken | metadata | filenameTextVar | | OK |
| $adminAuthToken | metadata | filesizeTextVar | | OK |
| $adminAuthToken | metadata | mimeTypeTextVar | | OK |

*!
!3 Binary is the abstract type that other binary material inherits
!***> Load binaryGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | binaryGroup | |

*!
!***> Check children in binaryGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoGroup | 1 | 1 |
| metadata | resourceInfoGroup | 0 | 1 |

*!
!3 Generic binary is used when the type of binary material is unknown before upload
!***> Load genericBinaryNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | genericBinaryNewGroup | |

*!
!***> Check children in genericBinaryNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoCoraAutogeneratedNewGroup | 1 | 1 |
| metadata | filenameTextVar | 1 | 1 |
| metadata | filesizeTextVar | 1 | 1 |

*!
!***> Load genericBinaryGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | genericBinaryGroup | |

*!
!***> Check children in genericBinaryGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoGroup | 1 | 1 |
| metadata | filenameTextVar | 1 | 1 |
| metadata | filesizeTextVar | 1 | 1 |

*!
!***> Load recordInfoCoraAutogeneratedNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoCoraAutogeneratedNewGroup | |

*!
!***> Check children in recordInfoCoraAutogeneratedNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | dataDividerCoraLink | 1 | 1 |

*!
!3 Image
!***> Load imageNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | imageNewGroup | |

*!
!***> Check children in imageNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoAutogeneratedNewGroup | 1 | 1 |
| metadata | resourceInfoGroup | 0 | 1 |

*!
!***> Load imageGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | imageGroup | |

*!
!***> Check children in imageGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoGroup | 1 | 1 |
| metadata | resourceInfoGroup | 0 | 1 |

*!
!3 Sound
!***> Load soundNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | soundNewGroup | |

*!
!***> Check children in soundNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoAutogeneratedNewGroup | 1 | 1 |
| metadata | resourceInfoGroup | 0 | 1 |

*!
!***> Load soundGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | soundGroup | |

*!
!***> Check children in soundGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | recordInfoGroup | 1 | 1 |
| metadata | resourceInfoGroup | 0 | 1 |

*!
!***> Load recordInfoAutogeneratedNewGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoAutogeneratedNewGroup | |

*!
!***> Check children in recordInfoAutogeneratedNewGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | dataDividerLink | 1 | 1 |

*!
!***> Load metadataGroupForResourceLinkGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | metadataGroupForResourceLinkGroup | |

*!
!***> Check children in metadataGroupForResourceLinkGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | streamIdTextVar | 1 | 1 |
| metadata | filenameTextVar | 1 | 1 |
| metadata | filesizeTextVar | 1 | 1 |
| metadata | mimeTypeTextVar | 1 | 1 |

*!
!***> Load resourceInfoGroup to use in tests

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | resourceInfoGroup | |

*!
!***> Check children in resourceInfoGroup

!| MetadataLinkFixture |
| linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? |
| metadata | masterResLink | 1 | 1 |
| metadata | thumbnailGroup | 0 | 1 |
| metadata | thumbnailLargeGroup | 0 | 1 |
| metadata | thumbnailSmallGroup | 0 | 1 |

*!
!***> Read metadataResourceLink (masterResLink)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | metadata | masterResLink | | OK |

*!
!***> Read recordType (binary, image, sound)

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | binary | | OK |
| $adminAuthToken | recordType | binary | | OK |
| $adminAuthToken | recordType | binary | | OK |

*!
!2 Test with new image
!***> Create data of recordType image (autogeneratedId)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? | getCreatedId? |
| $adminAuthToken | binary | {"children":[{"children":[{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"image"}],"name":"validationType"}],"name":"recordInfo"}],"name":"binary","attributes":{"type":"image"}} | | CREATED | $createdId= |

*!
!***> Read image

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | =~/"name":"id","value":"$createdId"/ | OK |

*!
!***> Update data of recordType image

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | {"children":[{"children":[{"name":"id","value":"$createdId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"binary"}],"name":"type"},{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}],"name":"createdBy"},{"name":"tsCreated","value":"2017-10-01T00:00:00.000000Z"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"image"}],"name":"validationType"}],"name":"recordInfo"}],"name":"binary","attributes":{"type":"image"}} | | OK |

*!
!***> Upload image

(Uses a stream generated at the server)

!| RecordEndpointFixture |
| authToken | type | id | fileName | testUpload? | getStatusType? | getStreamId? |
| $adminAuthToken | binary | $createdId | adele.png | | OK | $streamId= |

*!
!***> Read image

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | | OK |

*!
!***> Download image

(Uses a stream generated at the server)

!| RecordEndpointFixture |
| authToken | type | id | resourceName | testDownload? | getContentLength? | getContentDisposition? | getStatusType? |
| $adminAuthToken | binary | $createdId | master | | 8 | attachment; filename=adele.png | OK |

*!
!***> List data(binary, image, sound)

!| RecordEndpointFixture |
| type | testReadRecordList? | getStatusType? |
| binary | | OK |
| binary | | OK |

*!
!***> Clean up created data

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | | OK |

*!
!2 Test with new sound
!***> Create data of recordType sound (autogeneratedId)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? | getCreatedId? |
| $adminAuthToken | binary | {"children":[{"children":[{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"sound"}],"name":"validationType"}],"name":"recordInfo"}],"name":"binary","attributes":{"type":"sound"}} | | CREATED | $createdId= |

*!
!***> Read sound

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | | OK |

*!
!***> Update data of recordType sound

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | {"children":[{"children":[{"name":"id","value":"$createdId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"binary"}],"name":"type"},{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"131313"}],"name":"createdBy"},{"name":"tsCreated","value":"2017-10-01T00:00:00.000000Z"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"sound"}],"name":"validationType"}],"name":"recordInfo"}],"name":"binary","attributes":{"type":"sound"}} | | OK |

*!
!***> Upload sound

(Uses a stream generated at the server)

!| RecordEndpointFixture |
| authToken | type | id | fileName | testUpload? | getStatusType? | getStreamId? |
| $adminAuthToken | binary | $createdId | adele.png | | OK | $streamId= |

*!
!***> Read sound

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | | OK |

*!
!***> Download sound

(Uses a stream generated at the server)

!| RecordEndpointFixture |
| authToken | type | id | resourceName | testDownload? | getContentLength? | getContentDisposition? | getStatusType? |
| $adminAuthToken | binary | $createdId | master | | 8 | attachment; filename=adele.png | OK |

*!
!***> List data(binary, image, sound)

!| RecordEndpointFixture |
| type | testReadRecordList? | getStatusType? |
| binary | | OK |
| binary | | OK |

*!
!***> Clean up created data

!| RecordEndpointFixture |
| authToken | type | id | testDeleteRecord? | getStatusType? |
| $adminAuthToken | binary | $createdId | | OK |

*!
