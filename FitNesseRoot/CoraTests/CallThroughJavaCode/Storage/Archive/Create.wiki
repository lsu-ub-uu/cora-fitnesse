---
Static
---
!2 Create
 * '''Case 1:''' It must be possible to store a new record in the archive
 * '''Case 2:''' It must be possible to store a new binary in the archive
!***> SetUp: Update storeInArchive for Demo recordType 
!include -seamless .HelperPages.defineAdminAuthToken 

!define updateDemoRecordType {!-{"children":[{"children":[{"name":"linkedRecordType","value":"metadata"},{"name":"linkedRecordId","value":"demoGroup"}],"name":"metadataId"},{"children":[{"name":"id","value":"demo"},{"children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"recordType"}],"name":"type"},{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"141414"}],"name":"createdBy"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"name":"tsCreated","value":"2018-08-29T14:09:07.043000Z"},{"repeatId":"0","children":[{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"141414"}],"name":"updatedBy"},{"name":"tsUpdated","value":"2018-08-29T14:09:07.043000Z"}],"name":"updated"},{"repeatId":"1","children":[{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"141414"}],"name":"updatedBy"},{"name":"tsUpdated","value":"2019-01-21T10:31:58.129000Z"}],"name":"updated"},{"repeatId":"2","children":[{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"141414"}],"name":"updatedBy"},{"name":"tsUpdated","value":"2019-01-23T13:26:06.700000Z"}],"name":"updated"},{"repeatId":"3","children":[{"children":[{"name":"linkedRecordType","value":"user"},{"name":"linkedRecordId","value":"141414"}],"name":"updatedBy"},{"name":"tsUpdated","value":"2022-03-24T15:15:27.748031Z"}],"name":"updated"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"recordType"}],"name":"validationType"}],"name":"recordInfo"},{"children":[{"name":"linkedRecordType","value":"presentation"},{"name":"linkedRecordId","value":"demoOutputPGroup"}],"name":"presentationViewId"},{"children":[{"name":"linkedRecordType","value":"presentation"},{"name":"linkedRecordId","value":"demoMenuPGroup"}],"name":"menuPresentationViewId"},{"children":[{"name":"linkedRecordType","value":"presentation"},{"name":"linkedRecordId","value":"demoListPGroup"}],"name":"listPresentationViewId"},{"name":"userSuppliedId","value":"true"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"demoText"}],"name":"textId"},{"children":[{"name":"linkedRecordType","value":"text"},{"name":"linkedRecordId","value":"demoDefText"}],"name":"defTextId"},{"children":[{"name":"linkedRecordType","value":"search"},{"name":"linkedRecordId","value":"demoSearch"}],"name":"search"},{"children":[{"name":"linkedRecordType","value":"presentation"},{"name":"linkedRecordId","value":"demoAutocompletePGroup"}],"name":"autocompletePresentationView"},{"repeatId":"0","name":"groupOfRecordType","value":"other"},{"name":"public","value":"false"},{"name":"storeInArchive","value":"true"}],"name":"recordType"}-!}

!define recordType {recordType}
!define recordId {demo}
!define updateData updateDemoRecordType
!define expectedAnswer {}
!define expectedUpdateResult {OK}

!include -seamless .HelperPages.updateRecord
*!

!***> '''Case 1'''
Show file structure before storing a new record
!include -seamless .HelperPages.archiveFile

#!define createDemoRecord {!-{"children":[{"children":[{"name":"id","value":"demo:$tempDemoId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"demo"}],"name":"validationType"}],"name":"recordInfo"},{"name":"bookTitle","value":"Harry Potter"}],"name":"book"}-!}
!define createDemoRecord {!-{"name":"fitnesseExample","children":[{"name":"recordInfo","children":[{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"fitnesseValidationType"}]}]},{"name":"fitnesseTextVar","value":"myRecordInArchive"}]}-!}

!define recordType {fitnesseRecordType}
!define createData createDemoRecord
!define expectedAnswer {}
!define expectedCreateResult {CREATED}
#!define archiveFileName {fitnesseRecordType:$createdRecordId}
!define archiveFileName {fitnesseRecordType:$tmpRecordId1}
!define archiveVersion1 {v1}
!define archiveVersion2 {v1}


!***> Create record, for recordType ${recordType}

!| ChildComparerFixture |
| authToken | type | json | testCreateAndStoreRecord? | getStatusType? | getCreatedId? |
| ${currentAuthToken} | ${recordType} | ${createData} | ${expectedAnswer} | ${expectedCreateResult} | $tmpRecordId1= |

!define expectedAnswer {}
!define recordId {$createdRecordId}
*!

!include -seamless .HelperPages.showFileVersion

Show file structure after storing a new record
!include -seamless .HelperPages.archiveFile

*!
!***> '''Case 2'''

!define createBinaryGeneric {!-{"name":"binary","children":[{"name":"recordInfo","children":[{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]},{"name":"validationType","children":[{"name":"linkedRecordType","value":"validationType"},{"name":"linkedRecordId","value":"genericBinary"}]}]},{"name":"originalFileName","value":"aBinaryText.txt"},{"name":"expectedFileSize","value":"110104"}],"attributes":{"type":"generic"}}-!}
!define recordType {binary}
!define createData createBinaryGeneric
!define expectedAnswer {}
!define expectedCreateResult {CREATED}

!define archiveFileName {binary:$tmpRecordId2-master}
!define archiveVersion1 {v1}
!define archiveVersion2 {v1}

!***> Create record, for recordType ${recordType}

!| ChildComparerFixture |
| authToken | type | json | testCreateAndStoreRecord? | getStatusType? | getCreatedId? |
| ${currentAuthToken} | ${recordType} | ${createData} | ${expectedAnswer} | ${expectedCreateResult} | $tmpRecordId2= |

!define expectedAnswer {}
!define recordId {$createdRecordId}
*!

!***> Upload image

(Uses a stream generated at the server)

!| RecordEndpointFixture |
| authToken | type | id | fileName | testUpload? | getStatusType? |
| $adminAuthToken | binary | $tmpRecordId2 | aBinaryText.txt | =~/"name":"originalFileName","value":"aBinaryText.txt".*"name":"fileSize","value":"8".*"name":"mimeType","value":"text/plain".*"name":"checksum","value":"d9f28c8b153ee8916c7f8faaa9d94bb04d06da7616034a4cd7e03102e30fa67cfa8eee1e7afbc7d3a5909285e41b24b16e08b2f7338d15398554407cf7025b45"/| OK |

*!
!include -seamless .HelperPages.showFileVersion

Show file structure after storing a new record
!include -seamless .HelperPages.archiveFile

*!
